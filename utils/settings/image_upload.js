(function(_0x434293,_0x3aef3f){const _0x5f05ae=_0x434293();function _0x157583(_0x38eb88,_0x23338f,_0xc17309,_0x29119d){return _0x27eb(_0x29119d-0x13b,_0x38eb88);}function _0x1d2b6b(_0x26740e,_0x32673b,_0x2ac542,_0x579939){return _0x27eb(_0x2ac542-0x1e1,_0x579939);}while(!![]){try{const _0x3c39d5=-parseInt(_0x157583(0x2e9,0x2fc,0x373,0x343))/(0x255+0xa8e+-0x22*0x61)*(parseInt(_0x1d2b6b(0x33e,0x2f1,0x309,0x36c))/(-0x1e71*0x1+-0x598*0x3+-0x2f3b*-0x1))+parseInt(_0x1d2b6b(0x34c,0x33c,0x399,0x38b))/(0x1669+-0x1aef+0x489)*(-parseInt(_0x1d2b6b(0x3b7,0x39a,0x38b,0x404))/(-0x260f+0x14d2+0x1141))+-parseInt(_0x157583(0x280,0x280,0x2a9,0x26c))/(-0x134a*-0x1+-0x1*0xb55+0xfe*-0x8)+-parseInt(_0x157583(0x2b5,0x2f7,0x2dd,0x315))/(0xa7*-0x1e+0x1*-0xbd8+-0x4*-0x7dc)*(-parseInt(_0x1d2b6b(0x30e,0x2df,0x331,0x2f0))/(-0x7*-0x511+0x3*-0xce5+0x33f))+-parseInt(_0x1d2b6b(0x3a5,0x305,0x34f,0x2e1))/(0x36*-0x98+0x630+-0x2*-0xcf4)+-parseInt(_0x1d2b6b(0x34f,0x2d5,0x35a,0x352))/(0x233+0x1668+0x1*-0x1892)+parseInt(_0x157583(0x2de,0x288,0x21d,0x27b))/(0x2*0x11c7+0x77d+0x65*-0x6d);if(_0x3c39d5===_0x3aef3f)break;else _0x5f05ae['push'](_0x5f05ae['shift']());}catch(_0x4c0a15){_0x5f05ae['push'](_0x5f05ae['shift']());}}}(_0x1630,0x411*-0x21a+-0xe72*0xb0+0x1ab590));const _0x36bb9a=(function(){const _0x479ee0={};_0x479ee0[_0x1fb5b5(0x386,0x307,0x387,0x308)]=function(_0x29098a,_0x2bacf5){return _0x29098a!==_0x2bacf5;},_0x479ee0[_0x1fb5b5(0x293,0x2d2,0x252,0x2e6)]='yBWYU',_0x479ee0['ASOaU']=_0x5a1a4f(0x330,0x308,0x2ae,0x2b5)+_0x1fb5b5(0x338,0x311,0x355,0x394)+_0x5a1a4f(0x320,0x291,0x333,0x2b3)+_0x1fb5b5(0x2f5,0x354,0x385,0x2e2)+'tu8-image-'+_0x5a1a4f(0x3f9,0x396,0x303,0x388)+'r';function _0x5a1a4f(_0x5e7931,_0x8a90eb,_0x3967ff,_0x858f0b){return _0x27eb(_0x858f0b-0x17b,_0x5e7931);}_0x479ee0[_0x5a1a4f(0x26d,0x29b,0x343,0x2d6)]=_0x5a1a4f(0x2d8,0x28d,0x314,0x2a6),_0x479ee0[_0x5a1a4f(0x32e,0x330,0x3af,0x3a8)]=_0x1fb5b5(0x362,0x3c8,0x440,0x3f9),_0x479ee0[_0x1fb5b5(0x353,0x3af,0x32a,0x41c)]='flex',_0x479ee0[_0x5a1a4f(0x3f8,0x38d,0x390,0x38c)]=_0x5a1a4f(0x3f3,0x36d,0x383,0x3a6)+_0x1fb5b5(0x3db,0x376,0x31c,0x3bc),_0x479ee0['hdAdV']=_0x5a1a4f(0x30d,0x373,0x2d0,0x314)+_0x5a1a4f(0x2d3,0x36e,0x2f4,0x322)+_0x1fb5b5(0x298,0x2db,0x26d,0x2db),_0x479ee0[_0x1fb5b5(0x307,0x389,0x324,0x33b)]=_0x5a1a4f(0x33c,0x420,0x3fb,0x3a7),_0x479ee0[_0x5a1a4f(0x36d,0x342,0x390,0x340)]='ztlnz';const _0x42384e=_0x479ee0;function _0x1fb5b5(_0x7bb4d7,_0x2202c3,_0x1bf091,_0x3f58c9){return _0x27eb(_0x2202c3-0x1a6,_0x1bf091);}let _0x4f0197=!![];return function(_0xda785f,_0x59dc81){const _0x34aefb={};_0x34aefb[_0x2518cb(0x470,0x435,0x40a,0x41a)]=_0x42384e[_0x2518cb(0x538,0x50f,0x4b1,0x4fd)];function _0x2518cb(_0x81ccc9,_0x177794,_0x2bfdff,_0x1a27fc){return _0x1fb5b5(_0x81ccc9-0x1de,_0x2bfdff-0x11d,_0x81ccc9,_0x1a27fc-0x156);}_0x34aefb[_0x2518cb(0x3e2,0x41c,0x41a,0x3b5)]='blob:',_0x34aefb[_0x2518cb(0x507,0x4b2,0x48c,0x507)]=function(_0x4bdbdb,_0x3dc8f1){return _0x4bdbdb!==_0x3dc8f1;},_0x34aefb['tzLWg']=_0x42384e[_0x2518cb(0x427,0x3a7,0x41e,0x40a)];function _0x7fd7bf(_0xa1090a,_0x1d83eb,_0x54585e,_0x3588ba){return _0x5a1a4f(_0x3588ba,_0x1d83eb-0x1bf,_0x54585e-0xb9,_0x1d83eb-0x187);}_0x34aefb[_0x2518cb(0x426,0x483,0x468,0x4bb)]=_0x42384e[_0x2518cb(0x469,0x522,0x4f0,0x570)],_0x34aefb[_0x7fd7bf(0x4c4,0x4c9,0x489,0x551)]=_0x42384e[_0x7fd7bf(0x50c,0x50b,0x4a0,0x524)],_0x34aefb[_0x2518cb(0x53f,0x4cf,0x4e7,0x492)]=_0x42384e[_0x7fd7bf(0x53d,0x513,0x582,0x537)],_0x34aefb[_0x7fd7bf(0x3d6,0x43d,0x446,0x3da)]='#novelai-i'+_0x7fd7bf(0x489,0x46d,0x415,0x406)+_0x7fd7bf(0x445,0x43a,0x4b7,0x4ac)+_0x2518cb(0x471,0x4ac,0x471,0x42e)+_0x2518cb(0x42a,0x461,0x487,0x4df)+'placeholde'+'r',_0x34aefb['JQRuW']=_0x42384e[_0x7fd7bf(0x4a9,0x4b9,0x4a5,0x438)],_0x34aefb[_0x7fd7bf(0x578,0x4f4,0x48f,0x4fb)]=_0x2518cb(0x4e4,0x51b,0x4f2,0x4f5)+'x',_0x34aefb[_0x2518cb(0x3d7,0x482,0x447,0x483)]=_0x42384e['bTZDc'];const _0x337edd=_0x34aefb;if('OFcdY'===_0x42384e[_0x7fd7bf(0x492,0x4c7,0x4f5,0x46f)]){const _0x1e3ed8=_0x54155b[_0x2518cb(0x4a7,0x556,0x4d9,0x4c0)+_0x7fd7bf(0x4be,0x529,0x558,0x577)](_0x2518cb(0x500,0x527,0x4ee,0x4d7)+_0x7fd7bf(0x47b,0x438,0x440,0x3de)),_0x3280bc=_0x48e089['querySelec'+_0x7fd7bf(0x482,0x49a,0x516,0x45e)](_0x337edd[_0x7fd7bf(0x469,0x449,0x435,0x498)]),_0x2bac10=_0x11abb7[_0x7fd7bf(0x4af,0x518,0x4d6,0x533)+'ById'](_0x7fd7bf(0x4cb,0x528,0x4b7,0x542)+_0x7fd7bf(0x52c,0x4a9,0x4a4,0x471)+_0x2518cb(0x45d,0x38c,0x3f8,0x373));_0x1e3ed8[_0x7fd7bf(0x4ee,0x4fc,0x47e,0x51e)]&&_0x1e3ed8[_0x2518cb(0x4ce,0x45d,0x4bd,0x48f)][_0x2518cb(0x485,0x3b5,0x41d,0x473)](_0x337edd['khvnL'])&&_0x337edd['YWFrv'](_0x1e3ed8[_0x7fd7bf(0x4a5,0x4fc,0x4b0,0x54f)],_0x140ec2)&&_0x58bb69['revokeObje'+_0x2518cb(0x3f6,0x429,0x409,0x3df)](_0x1e3ed8[_0x2518cb(0x4ef,0x52a,0x4bd,0x53f)]),_0x5e5fd7?(_0x1e3ed8['src']=_0x4de461,_0x1e3ed8[_0x7fd7bf(0x4b0,0x44e,0x429,0x452)][_0x2518cb(0x44b,0x490,0x4ac,0x516)]=_0x337edd[_0x2518cb(0x3d8,0x451,0x3f5,0x477)],_0x3280bc[_0x2518cb(0x48e,0x41a,0x40f,0x3fe)][_0x7fd7bf(0x471,0x4eb,0x49b,0x4a1)]=_0x7fd7bf(0x4b5,0x524,0x509,0x56d),_0x2bac10['style'][_0x2518cb(0x4f1,0x48a,0x4ac,0x4d1)]='inline-fle'+'x'):(_0x1e3ed8['src']='',_0x1e3ed8['style'][_0x7fd7bf(0x52c,0x4eb,0x524,0x537)]=_0x337edd[_0x7fd7bf(0x457,0x4a7,0x4ba,0x500)],_0x3280bc[_0x2518cb(0x3d8,0x448,0x40f,0x436)]['display']=_0x337edd['jsJZP'],_0x2bac10[_0x7fd7bf(0x4b1,0x44e,0x48f,0x441)][_0x2518cb(0x507,0x52c,0x4ac,0x526)]=_0x7fd7bf(0x530,0x524,0x560,0x4af),_0x111279[_0x2518cb(0x45e,0x41d,0x3fa,0x3ec)+_0x2518cb(0x48f,0x495,0x47d,0x468)]=null,_0x2abff0=null);}else{const _0x35b188=_0x4f0197?function(){function _0x4bd61c(_0x4acf76,_0x584870,_0x2b7223,_0x2c7f72){return _0x7fd7bf(_0x4acf76-0xd9,_0x2c7f72- -0x617,_0x2b7223-0x86,_0x4acf76);}function _0x1af5e9(_0x531b8f,_0x22e909,_0x3db794,_0x4aa0f0){return _0x2518cb(_0x4aa0f0,_0x22e909-0x70,_0x531b8f- -0x333,_0x4aa0f0-0x1ed);}if(_0x59dc81){if(_0x42384e[_0x4bd61c(-0x1cd,-0x1a2,-0x143,-0x1b4)](_0x1af5e9(0x194,0x19e,0x18e,0x1b1),_0x42384e[_0x4bd61c(-0x26e,-0x214,-0x19b,-0x1e9)])){const _0x2a76d6=_0x59dc81[_0x1af5e9(0x12e,0x12c,0xf6,0xc3)](_0xda785f,arguments);return _0x59dc81=null,_0x2a76d6;}else{const _0x491e81=_0x54922d[_0x1af5e9(0x1a6,0x120,0x22d,0x190)+_0x4bd61c(-0xc1,-0x86,-0x12e,-0xee)](_0x337edd['MJJfx']),_0xa8279d=_0x142073['querySelec'+'tor'](_0x337edd['KrliP']),_0x215066=_0x2d39a2[_0x4bd61c(-0x12a,-0xbb,-0x137,-0xff)+_0x1af5e9(0x1b7,0x17d,0x13a,0x188)](_0x337edd['JQRuW']);if(_0x17d062&&_0x2135d7[_0x4bd61c(-0x1b2,-0x19a,-0x1b6,-0x1bb)](_0x1af5e9(0x150,0x1d5,0x195,0x126))){_0x491e81[_0x1af5e9(0x18a,0x137,0x12c,0x10e)]=_0x5e75a0,_0x491e81[_0x4bd61c(-0x1b0,-0x1ba,-0x1a9,-0x1c9)][_0x1af5e9(0x179,0x10d,0x163,0x1a6)]=_0x337edd[_0x4bd61c(-0x1f5,-0x1f5,-0x220,-0x1e3)],_0xa8279d[_0x4bd61c(-0x22c,-0x24d,-0x18a,-0x1c9)][_0x1af5e9(0x179,0x15b,0x121,0x115)]=_0x337edd[_0x1af5e9(0x135,0x199,0x18f,0xf7)],_0x215066[_0x4bd61c(-0x189,-0x1a9,-0x1b6,-0x1c9)][_0x4bd61c(-0x101,-0x118,-0xa7,-0x12c)]=_0x337edd['qRPjT'];const _0x38899f=_0x2aff75[_0x1af5e9(0x17f,0x175,0x111,0x131)](','),_0x2e2847=_0x38899f[0x10e0+-0x730+-0x3e*0x28][_0x1af5e9(0x17f,0x13d,0x1f4,0x159)](':')[-0x24fc+0x3*0x981+0x87a]['split'](';')[0x377*-0x7+-0x22fa+0x101*0x3b];_0x243510=_0x2e2847,_0x4002bf[_0x1af5e9(0xdf,0x87,0xe4,0xf2)+_0x1af5e9(0x117,0xd4,0x97,0x12a)+'e']=_0x38899f[-0xed5+0xa70+0x466];const _0x55ad95={};_0x55ad95['id']=_0x4c9fd6,_0x55ad95['data']=_0x52314e,_0x4c50da[_0x1af5e9(0x1b0,0x169,0x22d,0x137)+_0x4bd61c(-0x13d,-0x14c,-0x1a8,-0x152)](_0x55ad95);}else{const _0x276d39=_0x337edd['fSscl']['split']('|');let _0x498a93=0x5*-0x6b+0x49*-0x6d+0x212c;while(!![]){switch(_0x276d39[_0x498a93++]){case'0':_0x491e81[_0x1af5e9(0x18a,0x1a4,0x161,0x1b4)]='';continue;case'1':_0x215066[_0x1af5e9(0xdc,0x152,0x67,0x9f)][_0x1af5e9(0x179,0x1bb,0x174,0x1ef)]=_0x1af5e9(0x1b2,0x194,0x226,0x21e);continue;case'2':_0x491e81['style'][_0x4bd61c(-0x18f,-0x15c,-0x136,-0x12c)]=_0x337edd['kpkht'];continue;case'3':_0xa8279d['style'][_0x4bd61c(-0xf5,-0x15c,-0xd0,-0x12c)]=_0x337edd[_0x1af5e9(0x157,0x146,0x13c,0xf3)];continue;case'4':_0x518676[_0x4bd61c(-0x21b,-0x1a6,-0x212,-0x1c6)+_0x4bd61c(-0x1df,-0x164,-0x1c4,-0x18e)+'e']=null;continue;}break;}}}}}:function(){};return _0x4f0197=![],_0x35b188;}};}()),_0x56dbfb=_0x36bb9a(this,function(){const _0xa49926={};_0xa49926[_0x4caf9a(0xd2,0xfe,0x69,0xed)]='(((.+)+)+)'+'+$';function _0x4745ef(_0x46363b,_0x2d0b1e,_0x48ff5b,_0x11062c){return _0x27eb(_0x2d0b1e- -0x28b,_0x11062c);}function _0x4caf9a(_0x3ef49,_0xd2cc81,_0x1fedc8,_0x60ea51){return _0x27eb(_0x3ef49- -0x10c,_0xd2cc81);}const _0x268821=_0xa49926;return _0x56dbfb[_0x4caf9a(0x69,0xb9,0xcc,0x9a)]()[_0x4745ef(-0x18c,-0x142,-0x162,-0xc4)](_0x268821[_0x4caf9a(0xd2,0xef,0x14c,0xcf)])[_0x4caf9a(0x69,0xd5,0xc9,0xd0)]()[_0x4caf9a(0xdc,0x6a,0x13b,0x98)+'r'](_0x56dbfb)[_0x4745ef(-0x136,-0x142,-0xff,-0xcb)]('(((.+)+)+)'+'+$');});function _0x46872d(_0x37f095,_0x220500,_0x36355c,_0x5a3ced){return _0x27eb(_0x220500-0x18d,_0x36355c);}_0x56dbfb();import{extension_settings}from'../../../../../extensions.js';import{saveSettingsDebounced}from'../../../../../../script.js';import{extensionName}from'../config.js';import{processUploadedImage,processUploadedImageToBlob,addLog}from'../utils.js';import{dbs}from'../database.js';const NAI_VIBE_CACHE_KEY=_0x4e3aef(0xaf,0xd1,0x5f,0x37)+_0x46872d(0x2d4,0x2b7,0x302,0x31f)+_0x46872d(0x2d7,0x2f7,0x27e,0x343)+_0x4e3aef(0xc0,0x8d,0xb9,0xbe),NAI_CHAR_REF_CACHE_KEY=_0x46872d(0x2ab,0x2f4,0x312,0x296)+'lai_char_r'+_0x4e3aef(0x14b,0x174,0x118,0xca),COMFYUI_REF_CACHE_KEY=_0x4e3aef(0x125,0x16d,0xd4,0xf2)+'yui_ref_im'+_0x46872d(0x2f9,0x305,0x366,0x29f);let nai3VibeTransferImageMimeType=_0x46872d(0x3d7,0x36e,0x361,0x3c5),nai3CharRefImageMimeType=_0x4e3aef(0x129,0xdb,0xdd,0x1ad),comfyuiImageObjectURL=null;function updateNovelaiImagePreview(_0x499920){const _0x99869={};_0x99869['SQhHr']='#novelai-i'+_0x42c3c5(0x4cd,0x4ee,0x50c,0x4e5)+_0x4be502(-0x143,-0x1cf,-0xe1,-0x14e)+_0x4be502(-0xcf,-0x156,-0x7d,-0xd8)+_0x4be502(-0x55,-0x48,-0x45,-0xc2)+_0x4be502(-0x77,-0xf0,-0x2,-0x79)+'r',_0x99869[_0x42c3c5(0x587,0x52d,0x503,0x507)]=_0x4be502(-0x73,-0x146,-0x113,-0xc6),_0x99869[_0x4be502(-0xb4,-0x82,-0x2d,-0x7c)]=_0x42c3c5(0x43d,0x527,0x45d,0x4a5),_0x99869[_0x4be502(-0xdc,-0x43,-0x71,-0x81)]=_0x4be502(-0x76,0x0,-0x51,-0x57)+'x';function _0x42c3c5(_0x2c6087,_0x3534ce,_0x167f90,_0x3f0bc3){return _0x46872d(_0x2c6087-0x1ed,_0x3f0bc3-0x1ed,_0x167f90,_0x3f0bc3-0xef);}function _0x4be502(_0x2eda8c,_0xbbadab,_0x25c76c,_0x554b47){return _0x46872d(_0x2eda8c-0xe4,_0x554b47- -0x413,_0x2eda8c,_0x554b47-0xb5);}_0x99869[_0x4be502(-0x9,-0x4b,-0x97,-0x56)]=_0x4be502(-0x41,-0xb6,-0x2e,-0x64);const _0x42dfe7=_0x99869,_0x17b6d8=document[_0x4be502(0x9,-0x70,-0x40,-0x70)+_0x4be502(-0x67,-0x5f,-0x4f,-0x5f)](_0x42c3c5(0x569,0x5df,0x536,0x5a5)+'ge_novelai'),_0x4b2519=document['querySelec'+_0x4be502(-0xf6,-0xbc,-0xe2,-0xee)](_0x42dfe7['SQhHr']),_0x19b250=document[_0x4be502(0xc,-0x80,-0x78,-0x70)+_0x4be502(-0xd0,0x14,-0xe3,-0x5f)]('novelai-re'+_0x4be502(-0x14a,-0x11a,-0x119,-0xdf)+'-btn');if(_0x499920&&_0x499920['startsWith'](_0x42dfe7[_0x4be502(-0x162,-0x155,-0x15b,-0xf9)])){_0x17b6d8['src']=_0x499920,_0x17b6d8[_0x4be502(-0x19b,-0x130,-0x157,-0x13a)][_0x4be502(-0xfb,-0x100,-0xe6,-0x9d)]=_0x42dfe7['VrYVk'],_0x4b2519['style'][_0x4be502(-0xf3,-0x11d,-0x8b,-0x9d)]='none',_0x19b250['style']['display']=_0x42dfe7[_0x42c3c5(0x51d,0x5cc,0x5f3,0x57f)];const _0x4cf912=_0x499920[_0x4be502(-0x32,-0xe8,-0x69,-0x97)](','),_0x55362a=_0x4cf912[0x21f0+0x1a12+-0x3c02]['split'](':')[-0xadb+0xe2f+-0x353][_0x4be502(-0x79,-0xd4,-0x7e,-0x97)](';')[-0x6be*-0x3+0x1*0x17e7+0x8f*-0x4f];nai3VibeTransferImageMimeType=_0x55362a,window[_0x42c3c5(0x458,0x44e,0x4a0,0x4c9)+_0x42c3c5(0x57d,0x50a,0x538,0x501)+'e']=_0x4cf912[-0x1849+-0x1*0x1f+0x1869*0x1];const _0x2a6626={};_0x2a6626['id']=NAI_VIBE_CACHE_KEY,_0x2a6626[_0x42c3c5(0x4a3,0x45e,0x4f0,0x4c5)]=_0x499920,dbs['storeReadW'+_0x42c3c5(0x56f,0x56b,0x5a5,0x53d)](_0x2a6626);}else _0x17b6d8[_0x4be502(-0x22,-0xb8,-0xec,-0x8c)]='',_0x17b6d8[_0x4be502(-0x134,-0x159,-0xbb,-0x13a)][_0x4be502(-0x6f,-0xc2,-0xd9,-0x9d)]=_0x42c3c5(0x617,0x5d6,0x612,0x59c),_0x4b2519[_0x42c3c5(0x540,0x4c9,0x44f,0x4c6)][_0x42c3c5(0x5ce,0x5c2,0x577,0x563)]=_0x42c3c5(0x59e,0x54c,0x4ee,0x51e),_0x19b250[_0x4be502(-0xdd,-0xbd,-0x115,-0x13a)][_0x42c3c5(0x573,0x590,0x4f3,0x563)]=_0x42dfe7['YGLKL'],window[_0x4be502(-0x1ba,-0x171,-0xaf,-0x137)+_0x42c3c5(0x4ee,0x4c3,0x4cb,0x501)+'e']=null;}function removeNovelaiImage(){function _0x2314bc(_0x300958,_0x2e1d8a,_0xbabac9,_0x2de2e7){return _0x46872d(_0x300958-0x16f,_0x2e1d8a-0x254,_0xbabac9,_0x2de2e7-0x133);}function _0xfb5b84(_0x4fdcff,_0x1bce5f,_0x5eb0f0,_0x571c54){return _0x4e3aef(_0x571c54- -0x14e,_0x5eb0f0,_0x5eb0f0-0x2c,_0x571c54-0x132);}const _0x48e104={'wGFhM':function(_0x2c0947,_0x3ace25){return _0x2c0947(_0x3ace25);}};_0x48e104[_0xfb5b84(-0x77,-0x41,-0x62,-0x48)](updateNovelaiImagePreview,null),dbs[_0x2314bc(0x650,0x5f0,0x669,0x617)+'e'](NAI_VIBE_CACHE_KEY);}function _0x27eb(_0x403623,_0x3a1541){_0x403623=_0x403623-(-0x1582+0xd*-0x2bf+0x3a56);const _0x1c97a1=_0x1630();let _0x39f5da=_0x1c97a1[_0x403623];if(_0x27eb['CiGabr']===undefined){var _0x1f35fe=function(_0x4cf026){const _0x52613c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x17dcc9='',_0x5ac18a='',_0xbd403c=_0x17dcc9+_0x1f35fe;for(let _0x5e74cb=-0x65e+0x1d51+-0x16f3,_0x1e6a45,_0x5711f9,_0x3b996b=-0x2304+-0x4*0xaf+0x12e*0x20;_0x5711f9=_0x4cf026['charAt'](_0x3b996b++);~_0x5711f9&&(_0x1e6a45=_0x5e74cb%(-0x7ac+-0x219e+-0x137*-0x22)?_0x1e6a45*(-0x58*-0x5+-0x1*-0x97+0x11*-0x1f)+_0x5711f9:_0x5711f9,_0x5e74cb++%(-0x1a8e+-0x20c7+0x3b59))?_0x17dcc9+=_0xbd403c['charCodeAt'](_0x3b996b+(0x1c+0xe71*0x1+-0x5*0x2e7))-(-0x39b+0x25a3+-0x21fe)!==-0x128f*0x1+-0x4ed*-0x5+-0x612?String['fromCharCode'](0x19cd*0x1+0x49*-0x6f+0x6d9&_0x1e6a45>>(-(0x1182*-0x1+0x1ae8+0x259*-0x4)*_0x5e74cb&0x1e38+-0x1695+-0x79d)):_0x5e74cb:0x2149+0x617*-0x3+-0xf04){_0x5711f9=_0x52613c['indexOf'](_0x5711f9);}for(let _0x2c6724=-0x1e15*-0x1+0x184b+0xe8*-0x3c,_0x5ece48=_0x17dcc9['length'];_0x2c6724<_0x5ece48;_0x2c6724++){_0x5ac18a+='%'+('00'+_0x17dcc9['charCodeAt'](_0x2c6724)['toString'](0x121*0x15+0x1c45+0x33ea*-0x1))['slice'](-(0x2*0xa1f+-0x19c5+-0xd*-0x6d));}return decodeURIComponent(_0x5ac18a);};_0x27eb['xeFKUp']=_0x1f35fe,_0x27eb['cCneyX']={},_0x27eb['CiGabr']=!![];}const _0x357328=_0x1c97a1[0x5eb+-0x7*-0x557+-0x2b4c],_0x1532c7=_0x403623+_0x357328,_0x3f02b4=_0x27eb['cCneyX'][_0x1532c7];if(!_0x3f02b4){const _0x1e56d6=function(_0x6fd819){this['qNxFaQ']=_0x6fd819,this['cDVMDA']=[0xc*-0x296+0x12e*-0x12+0x3445,-0x1a7a+-0x11b2+-0x2c2c*-0x1,0x2*-0x865+0x179e+-0x26*0x2e],this['CiRRqV']=function(){return'newState';},this['BxwNob']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['sAwWci']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x1e56d6['prototype']['MpUhNW']=function(){const _0x3d12db=new RegExp(this['BxwNob']+this['sAwWci']),_0x53e3c2=_0x3d12db['test'](this['CiRRqV']['toString']())?--this['cDVMDA'][-0x1f95+-0x79*-0xb+0x1a63]:--this['cDVMDA'][-0x255d+0xa*0xb8+0x1e2d];return this['bzAjKI'](_0x53e3c2);},_0x1e56d6['prototype']['bzAjKI']=function(_0x3cf88b){if(!Boolean(~_0x3cf88b))return _0x3cf88b;return this['kLJCjY'](this['qNxFaQ']);},_0x1e56d6['prototype']['kLJCjY']=function(_0x583ae8){for(let _0xdebdaa=0x16da+-0xecd+-0x80d,_0x3fadd7=this['cDVMDA']['length'];_0xdebdaa<_0x3fadd7;_0xdebdaa++){this['cDVMDA']['push'](Math['round'](Math['random']())),_0x3fadd7=this['cDVMDA']['length'];}return _0x583ae8(this['cDVMDA'][-0xa*-0x39f+-0x1cc6+-0x8*0xee]);},new _0x1e56d6(_0x27eb)['MpUhNW'](),_0x39f5da=_0x27eb['xeFKUp'](_0x39f5da),_0x27eb['cCneyX'][_0x1532c7]=_0x39f5da;}else _0x39f5da=_0x3f02b4;return _0x39f5da;}async function handleNovelaiImageUpload(_0x564fb4){const _0x1a97c2={'wFfPx':function(_0x100f16,_0x69c2e9){return _0x100f16(_0x69c2e9);},'rGsCt':'Error\x20proc'+_0x57fe35(-0x144,-0xe5,-0x17b,-0x14e)+_0x57fe35(-0x9c,-0xbb,-0xe2,-0x33)+':','BLhzi':function(_0x58ae9c,_0x111457){return _0x58ae9c(_0x111457);},'mdEXr':function(_0x712434,_0x11b191){return _0x712434+_0x11b191;},'VmMMI':_0x57fe35(-0x135,-0x15f,-0x1ae,-0x183)},_0x39e7f4=_0x564fb4[_0x2c0da7(0x5ab,0x590,0x572,0x5c4)][_0x2c0da7(0x4ad,0x499,0x519,0x599)][0xf2b+0x12ff+-0x222a*0x1];if(!_0x39e7f4)return;function _0x57fe35(_0x820b54,_0x37fb92,_0x4153a3,_0x298287){return _0x4e3aef(_0x820b54- -0x212,_0x4153a3,_0x4153a3-0x100,_0x298287-0x5b);}function _0x2c0da7(_0x111300,_0x22811f,_0x28f374,_0x5aa13c){return _0x46872d(_0x111300-0x1c,_0x28f374-0x1d9,_0x22811f,_0x5aa13c-0x152);}try{const _0x1443b7=await processUploadedImage(_0x39e7f4,!![]);_0x1a97c2[_0x2c0da7(0x425,0x4d3,0x496,0x4e5)](updateNovelaiImagePreview,_0x1443b7);}catch(_0x8bf5a0){console[_0x57fe35(-0x158,-0x137,-0x126,-0x199)](_0x1a97c2[_0x2c0da7(0x4c7,0x582,0x52e,0x4b2)],_0x8bf5a0),_0x1a97c2[_0x2c0da7(0x4e2,0x4ab,0x4b9,0x498)](alert,_0x1a97c2[_0x2c0da7(0x547,0x50f,0x513,0x4eb)](_0x1a97c2[_0x57fe35(-0xbc,-0x90,-0x104,-0x62)],_0x8bf5a0['message']));}}function updateNovelaiCharRefImagePreview(_0x11fee0){const _0xa85513={};_0xa85513[_0x1969dc(0x37d,0x34c,0x316,0x34e)]='none',_0xa85513[_0x17f110(-0x1f7,-0x218,-0x1dc,-0x20e)]='previewIma'+_0x1969dc(0x325,0x397,0x391,0x394)+_0x1969dc(0x3f4,0x3b9,0x336,0x391),_0xa85513[_0x17f110(-0x23b,-0x1d4,-0x249,-0x1fc)]=_0x17f110(-0x150,-0x1cb,-0x1d2,-0x152)+_0x17f110(-0x1d0,-0x110,-0x16a,-0x186)+_0x17f110(-0x20d,-0x1fe,-0x1b7,-0x184)+'btn',_0xa85513[_0x17f110(-0x27a,-0x238,-0x202,-0x28a)]=_0x17f110(-0x1d9,-0x2a5,-0x240,-0x259);function _0x17f110(_0x2f47be,_0xc4ee89,_0x7cf3d4,_0x5747b9){return _0x46872d(_0x2f47be-0x12c,_0x7cf3d4- -0x4f8,_0x5747b9,_0x5747b9-0x194);}_0xa85513[_0x17f110(-0x1a4,-0xf4,-0x153,-0x1c5)]=_0x17f110(-0x161,-0xd8,-0x13c,-0xd3)+'x',_0xa85513['RgaLa']=function(_0x2e1b32,_0x273f23){return _0x2e1b32===_0x273f23;},_0xa85513[_0x17f110(-0x1dc,-0x19e,-0x194,-0x149)]='QrpZQ',_0xa85513['gFdnX']=_0x1969dc(0x3a1,0x3cc,0x3f4,0x385),_0xa85513['Tpxlg']=_0x1969dc(0x2e1,0x3a5,0x3ac,0x33d);const _0x27d809=_0xa85513,_0x20e5ec=document['getElement'+'ById'](_0x27d809[_0x17f110(-0x193,-0x15b,-0x1dc,-0x250)]),_0x340c45=document[_0x17f110(-0x1b4,-0x1a9,-0x18b,-0x123)+'tor']('#novelai-c'+_0x1969dc(0x32d,0x2ef,0x289,0x2bc)+_0x1969dc(0x2c1,0x2bb,0x2fd,0x31b)+_0x1969dc(0x331,0x3cc,0x382,0x3b2)+_0x17f110(-0x216,-0x1d5,-0x1e3,-0x177)+'u8-image-p'+_0x1969dc(0x3b4,0x3a4,0x3c1,0x355)),_0x239372=document[_0x17f110(-0x188,-0x118,-0x155,-0x197)+_0x17f110(-0x177,-0x1a4,-0x144,-0x1af)](_0x27d809['GPjMy']);function _0x1969dc(_0x42b0f5,_0xd68b41,_0x491bcf,_0x597b98){return _0x46872d(_0x42b0f5-0x46,_0x597b98-0xc,_0xd68b41,_0x597b98-0x69);}if(_0x11fee0&&_0x11fee0[_0x17f110(-0x1e1,-0x1c6,-0x211,-0x211)](_0x1969dc(0x32f,0x3bd,0x31c,0x359))){_0x20e5ec[_0x1969dc(0x335,0x310,0x386,0x393)]=_0x11fee0,_0x20e5ec[_0x17f110(-0x25b,-0x1d8,-0x21f,-0x1d8)][_0x1969dc(0x3fa,0x3b1,0x393,0x382)]=_0x27d809[_0x17f110(-0x201,-0x19b,-0x202,-0x222)],_0x340c45[_0x17f110(-0x25f,-0x1ea,-0x21f,-0x1f9)][_0x1969dc(0x335,0x3e1,0x37b,0x382)]=_0x27d809[_0x17f110(-0x20e,-0x23e,-0x1b6,-0x138)],_0x239372['style'][_0x1969dc(0x324,0x302,0x31e,0x382)]=_0x27d809[_0x17f110(-0x172,-0x121,-0x153,-0x109)];const _0x271d56=_0x11fee0['split'](','),_0x15e915=_0x271d56[0x4a8+0x9*0x1a6+-0x137e][_0x17f110(-0x158,-0x1a2,-0x17c,-0x1b9)](':')[-0x2264+0x2*0xcbf+-0x2b*-0x35][_0x1969dc(0x334,0x310,0x3ae,0x388)](';')[-0x1277+0xa4e*-0x1+0x1cc5];nai3CharRefImageMimeType=_0x15e915,window[_0x17f110(-0x18c,-0x1ef,-0x1ef,-0x25b)+_0x1969dc(0x274,0x28e,0x316,0x2eb)]=_0x271d56[0x19c+0x1acc+0xb*-0x295];const _0x303cb3={};_0x303cb3['id']=NAI_CHAR_REF_CACHE_KEY,_0x303cb3[_0x17f110(-0x1a5,-0x21d,-0x220,-0x1bb)]=_0x11fee0,dbs[_0x1969dc(0x3b4,0x37c,0x364,0x3b9)+_0x1969dc(0x37c,0x305,0x365,0x35c)](_0x303cb3);}else{if(_0x27d809[_0x17f110(-0x22a,-0x1c5,-0x1a9,-0x144)](_0x1969dc(0x3b5,0x3b0,0x2fb,0x34b),_0x27d809[_0x17f110(-0x139,-0x1f9,-0x194,-0x15e)])){const _0x2055f0=_0x27d809[_0x17f110(-0x1f5,-0x13f,-0x1a1,-0x18f)][_0x17f110(-0x10a,-0x1b6,-0x17c,-0x10c)]('|');let _0x264c3a=0xb*-0x2ba+-0x140b+0x3209;while(!![]){switch(_0x2055f0[_0x264c3a++]){case'0':_0x340c45[_0x17f110(-0x1be,-0x240,-0x21f,-0x1bd)]['display']=_0x27d809['Tpxlg'];continue;case'1':window['nai3CharRe'+'fImage']=null;continue;case'2':_0x20e5ec['src']='';continue;case'3':_0x20e5ec[_0x17f110(-0x1c8,-0x28e,-0x21f,-0x218)][_0x17f110(-0x134,-0x1ab,-0x182,-0x1c5)]=_0x27d809[_0x17f110(-0x18e,-0x149,-0x1b6,-0x17d)];continue;case'4':_0x239372['style'][_0x1969dc(0x3e1,0x3bf,0x30e,0x382)]=_0x17f110(-0xc7,-0x182,-0x149,-0x168);continue;}break;}}else{_0x5b7ba2[_0x1969dc(0x3fe,0x313,0x3e5,0x393)]=_0x3dd5cf,_0x2a88bc[_0x17f110(-0x1b3,-0x19e,-0x21f,-0x283)][_0x1969dc(0x39f,0x38c,0x396,0x382)]='block',_0x21e9de[_0x1969dc(0x2db,0x2d8,0x27d,0x2e5)]['display']=_0x27d809[_0x17f110(-0x231,-0x150,-0x1b6,-0x208)],_0x155e40[_0x1969dc(0x28f,0x352,0x26b,0x2e5)][_0x1969dc(0x403,0x3b2,0x3f0,0x382)]=_0x17f110(-0x1b9,-0x1be,-0x13c,-0xc9)+'x';const _0x3b0f56=_0x317ad8[_0x1969dc(0x33a,0x334,0x31d,0x388)](','),_0x3df79f=_0x3b0f56[-0xb6*-0x1a+0x1608+-0x2884][_0x17f110(-0x1b4,-0x1ca,-0x17c,-0x18d)](':')[-0x4*-0x937+0x231a+-0x47f5]['split'](';')[-0x1e06+-0x2*-0x74a+0xf72];_0x476433=_0x3df79f,_0x3a47ce[_0x1969dc(0x362,0x2fb,0x36c,0x315)+_0x1969dc(0x2a1,0x329,0x2ec,0x2eb)]=_0x3b0f56[-0x19d5+-0x24*-0xc2+-0x172];const _0x83804c={};_0x83804c['id']=_0x484792,_0x83804c[_0x1969dc(0x27d,0x2a1,0x362,0x2e4)]=_0x2bdba9,_0x4e87c9['storeReadW'+_0x17f110(-0x200,-0x168,-0x1a8,-0x18d)](_0x83804c);}}}function removeNovelaiCharRefImage(){const _0x4fd426={'kDqTL':function(_0x31f3df,_0x29cf65){return _0x31f3df(_0x29cf65);}};_0x4fd426['kDqTL'](updateNovelaiCharRefImagePreview,null);function _0x513e2c(_0x507a97,_0x4063d5,_0x1ae31e,_0x3193b8){return _0x46872d(_0x507a97-0x126,_0x507a97- -0x3f6,_0x1ae31e,_0x3193b8-0xc9);}dbs[_0x513e2c(-0x5a,-0x3a,-0x6d,-0x81)+'e'](NAI_CHAR_REF_CACHE_KEY);}async function handleNovelaiCharRefImageUpload(_0x44913c){const _0x4ea171={'llfFR':function(_0x7d035a,_0x1b69c3){return _0x7d035a(_0x1b69c3);},'OUnwv':function(_0x359995,_0x151cb5){return _0x359995===_0x151cb5;},'GQave':_0x26a91c(0x7e,0x20,0x7c,0x98),'bchwL':_0x26a91c(0x3e,-0x12,0x47,0xb)+_0x26a91c(0x38,0x58,0x4a,0x4a)+_0x26a91c(0x8a,0x2e,0xbf,0x16)+_0x26a91c(0x8d,0x9,0xe0,0xf4)};function _0x26a91c(_0x41713f,_0x298911,_0x266f5e,_0x414f40){return _0x4e3aef(_0x41713f- -0x96,_0x266f5e,_0x266f5e-0x1de,_0x414f40-0x139);}const _0x59fdcd=_0x44913c['target']['files'][-0x8c3*0x1+-0x1*-0x593+0x330];if(!_0x59fdcd)return;function _0x297cba(_0x1eabe2,_0x22b21a,_0x12e564,_0xe318ca){return _0x4e3aef(_0x1eabe2- -0x312,_0x22b21a,_0x12e564-0x2f,_0xe318ca-0x111);}try{if(_0x4ea171[_0x297cba(-0x222,-0x1e7,-0x1f7,-0x221)]('aNfiG',_0x4ea171[_0x26a91c(0x5d,0x35,0x44,0x37)]))_0x4ea171[_0x297cba(-0x1df,-0x1a7,-0x1aa,-0x1c8)](_0x13be6b,_0x26355a[_0x26a91c(-0x3,-0x15,0x7c,0x77)]);else{const _0x666f2e=await processUploadedImage(_0x59fdcd);_0x4ea171[_0x297cba(-0x1df,-0x1eb,-0x221,-0x1b6)](updateNovelaiCharRefImagePreview,_0x666f2e);}}catch(_0x2e1984){console['error'](_0x4ea171[_0x26a91c(0x8e,0xe,0xf0,0xb2)],_0x2e1984),alert(_0x26a91c(0x47,-0x20,0x98,0x1b)+_0x2e1984[_0x26a91c(0x30,-0x3b,-0x4a,-0x58)]);}}function updateComfyUIImagePreview(_0x3993b0){function _0x20ec00(_0x13053f,_0x26e727,_0x25ffef,_0x21f6ea){return _0x4e3aef(_0x13053f-0x2f0,_0x26e727,_0x25ffef-0x8f,_0x21f6ea-0x18f);}const _0x2dc093={};_0x2dc093['knAuJ']=_0x42c687(0x67,0xa2,0xc9,0xcb),_0x2dc093['jwPDM']=_0x42c687(0x144,0x18a,0x1f5,0x1c2),_0x2dc093[_0x20ec00(0x41c,0x49d,0x39f,0x405)]='inline-fle'+'x',_0x2dc093[_0x20ec00(0x462,0x40d,0x4dc,0x423)]='1|3|0|2|4',_0x2dc093[_0x42c687(0xbe,0x74,0x60,0xe3)]='flex';function _0x42c687(_0x1a614c,_0x53bb5f,_0x55af59,_0x578286){return _0x4e3aef(_0x578286-0x58,_0x55af59,_0x55af59-0xae,_0x578286-0x9a);}_0x2dc093[_0x20ec00(0x377,0x3a3,0x378,0x3db)]='#comfyui-i'+'mage-previ'+_0x42c687(0x105,0xfc,0x8a,0xd8)+'er\x20.st-cha'+_0x20ec00(0x3fc,0x46a,0x3cf,0x381)+_0x20ec00(0x445,0x447,0x432,0x4aa)+'r',_0x2dc093[_0x42c687(0xfa,0x1ac,0x1ab,0x175)]=_0x20ec00(0x41f,0x49b,0x44b,0x447),_0x2dc093[_0x20ec00(0x38d,0x306,0x415,0x3c7)]=function(_0x127587,_0x2d79cd){return _0x127587!==_0x2d79cd;},_0x2dc093[_0x20ec00(0x39b,0x3f6,0x3ef,0x408)]=_0x42c687(0x12d,0x77,0xd3,0xf4),_0x2dc093[_0x42c687(0xbb,0x14d,0x155,0x13d)]=function(_0x1ef615,_0x494e25){return _0x1ef615===_0x494e25;},_0x2dc093['pLbeS']=_0x42c687(0x9e,0xa9,0xfa,0xf9),_0x2dc093[_0x42c687(0x236,0x216,0x134,0x1b3)]=function(_0xcc24c9,_0x59f28b){return _0xcc24c9===_0x59f28b;},_0x2dc093[_0x20ec00(0x395,0x3ae,0x3a8,0x37b)]=_0x42c687(0x48,0xe6,0x96,0xc4),_0x2dc093[_0x20ec00(0x3c2,0x3a3,0x363,0x3f6)]=_0x20ec00(0x434,0x432,0x46c,0x493),_0x2dc093[_0x20ec00(0x3f1,0x422,0x454,0x3fb)]=_0x20ec00(0x406,0x3b5,0x46a,0x399)+'1';const _0x1f0f83=_0x2dc093,_0x4f6088=document[_0x42c687(0x235,0x12e,0x19c,0x1b6)+_0x42c687(0x172,0x1bf,0x1d6,0x1c7)](_0x20ec00(0x463,0x3db,0x46d,0x438)+_0x20ec00(0x36e,0x379,0x311,0x30b)),_0x811ea1=document[_0x42c687(0x180,0x183,0x15c,0x180)+'tor'](_0x1f0f83[_0x20ec00(0x377,0x3c1,0x34c,0x345)]),_0x556c66=document[_0x20ec00(0x44e,0x409,0x464,0x470)+_0x42c687(0x1b1,0x242,0x156,0x1c7)](_0x42c687(0x1e2,0x16f,0x194,0x1c6)+'move-image'+'-btn');if(_0x4f6088['src']&&_0x4f6088[_0x42c687(0x19a,0x160,0x1cc,0x19a)]['startsWith'](_0x1f0f83['CHZAV'])&&_0x4f6088[_0x42c687(0x219,0x1e6,0x21b,0x19a)]!==_0x3993b0){if(_0x1f0f83[_0x20ec00(0x38d,0x3f7,0x385,0x3b6)](_0x1f0f83[_0x42c687(0x8f,0x11c,0x16e,0x103)],_0x1f0f83[_0x42c687(0xed,0xe0,0x133,0x103)])){const _0x381636=_0x357328['getElement'+_0x42c687(0x240,0x158,0x22e,0x1c7)](_0x42c687(0x211,0x189,0x145,0x1cb)+'ge_nai_cha'+_0x42c687(0x1b8,0x1e0,0x15c,0x198)),_0x4caba4=_0x1532c7['querySelec'+_0x42c687(0x1b8,0xf0,0xdb,0x138)]('#novelai-c'+_0x42c687(0xe4,0xd6,0xc9,0xc3)+_0x42c687(0xcf,0x16f,0x12b,0x122)+_0x42c687(0x1ac,0x182,0x170,0x1b9)+_0x42c687(0xa8,0xb9,0x173,0x128)+_0x20ec00(0x461,0x4cb,0x3fd,0x480)+_0x20ec00(0x3f4,0x375,0x3cd,0x3d7)),_0x4d6afc=_0x3f02b4[_0x20ec00(0x44e,0x44f,0x459,0x4b7)+'ById'](_0x20ec00(0x3d1,0x34a,0x43c,0x422)+_0x20ec00(0x439,0x485,0x3e2,0x4b6)+_0x20ec00(0x3ec,0x3c1,0x3e1,0x46a)+_0x42c687(0x149,0x1a5,0x186,0x190));if(_0x4cf026&&_0x52613c[_0x42c687(0x118,0x143,0x104,0xfa)](_0x20ec00(0x3f8,0x394,0x462,0x40c))){_0x381636['src']=_0x5ece48,_0x381636[_0x20ec00(0x384,0x303,0x3d0,0x37c)][_0x42c687(0x15a,0x158,0x1c0,0x189)]=_0x1f0f83[_0x20ec00(0x42d,0x422,0x412,0x418)],_0x4caba4[_0x42c687(0xf8,0xc5,0x90,0xec)][_0x42c687(0x1a1,0x1b6,0x1bd,0x189)]=_0x1f0f83['jwPDM'],_0x4d6afc[_0x42c687(0xe4,0xa3,0x89,0xec)]['display']=_0x1f0f83[_0x20ec00(0x41c,0x425,0x471,0x430)];const _0x5a4d18=_0x1e56d6[_0x42c687(0x1bd,0x1bf,0x206,0x18f)](','),_0x5524d9=_0x5a4d18[0xa61+0x897*0x1+-0x12f8][_0x42c687(0x10b,0x13b,0x139,0x18f)](':')[-0x1*0x831+0x2674+-0xf21*0x2][_0x20ec00(0x427,0x432,0x41e,0x3e9)](';')[-0x5*-0x1f1+0xbfd+0xad9*-0x2];_0x6fd819=_0x5524d9,_0x3d12db[_0x20ec00(0x3b4,0x381,0x3cc,0x353)+_0x20ec00(0x38a,0x31e,0x35f,0x368)]=_0x5a4d18[0x1*0x80b+-0x5*-0x599+-0x2407*0x1];const _0x17613a={};_0x17613a['id']=_0x3cf88b,_0x17613a[_0x20ec00(0x383,0x34f,0x347,0x3f3)]=_0x583ae8,_0x53e3c2['storeReadW'+'rite'](_0x17613a);}else{const _0x21319f=_0x1f0f83['CHbwI'][_0x42c687(0x195,0x1cf,0x212,0x18f)]('|');let _0x55ec93=-0x1c65+-0x21bf+-0x2*-0x1f12;while(!![]){switch(_0x21319f[_0x55ec93++]){case'0':_0x4caba4[_0x42c687(0x14e,0xeb,0x97,0xec)][_0x42c687(0x183,0x1a3,0x175,0x189)]=_0x1f0f83[_0x20ec00(0x37b,0x3e6,0x3ee,0x2f9)];continue;case'1':_0x381636[_0x20ec00(0x432,0x45d,0x451,0x4b6)]='';continue;case'2':_0x4d6afc[_0x42c687(0xb0,0xeb,0x85,0xec)][_0x42c687(0x13a,0x12b,0x143,0x189)]=_0x1f0f83[_0x42c687(0x109,0x186,0xb8,0x113)];continue;case'3':_0x381636[_0x42c687(0x7f,0x125,0xd6,0xec)]['display']=_0x1f0f83[_0x42c687(0x116,0x17c,0xbc,0x113)];continue;case'4':_0xdebdaa['nai3CharRe'+'fImage']=null;continue;}break;}}}else URL[_0x20ec00(0x3e7,0x3cf,0x41d,0x431)+_0x20ec00(0x37e,0x3b9,0x359,0x39d)](_0x4f6088[_0x42c687(0x12c,0x1e7,0x17e,0x19a)]);}if(_0x3993b0){if(_0x1f0f83[_0x20ec00(0x3d5,0x3e2,0x363,0x430)](_0x42c687(0xc3,0x13b,0xfa,0xf9),_0x1f0f83[_0x20ec00(0x3ae,0x3dc,0x3d3,0x34a)]))_0x4f6088[_0x42c687(0x166,0x1c6,0x1b5,0x19a)]=_0x3993b0,_0x4f6088[_0x20ec00(0x384,0x37c,0x350,0x345)]['display']=_0x1f0f83[_0x20ec00(0x42d,0x408,0x4b0,0x3a9)],_0x811ea1['style'][_0x42c687(0x137,0x177,0x10b,0x189)]=_0x1f0f83[_0x42c687(0x11b,0x173,0xc4,0x113)],_0x556c66[_0x20ec00(0x384,0x31e,0x36c,0x33f)]['display']=_0x1f0f83['coWRt'];else{const _0x99d8f0=_0x6a7f15?function(){function _0x2b2703(_0x3aeb87,_0x8ef701,_0x2ff25e,_0x3d9430){return _0x20ec00(_0x8ef701- -0x291,_0x3aeb87,_0x2ff25e-0xdc,_0x3d9430-0x16a);}if(_0x3068db){const _0x2fdba2=_0x17ee0c[_0x2b2703(0x155,0x145,0x140,0x1c6)](_0x56205d,arguments);return _0x401591=null,_0x2fdba2;}}:function(){};return _0x31c913=![],_0x99d8f0;}}else{if(_0x1f0f83[_0x20ec00(0x44b,0x3da,0x4bd,0x483)](_0x1f0f83[_0x20ec00(0x395,0x373,0x332,0x310)],_0x1f0f83[_0x20ec00(0x3c2,0x33e,0x375,0x36d)]))_0x510515[_0x42c687(0x11a,0x171,0xc9,0x112)]('Error\x20load'+_0x20ec00(0x3bd,0x42a,0x365,0x42e)+'\x20NovelAI\x20V'+_0x42c687(0x15c,0xf2,0xf8,0x14c),_0x4c16c2);else{const _0x1f33ba=_0x1f0f83[_0x42c687(0x157,0x154,0x1af,0x159)][_0x42c687(0x1ac,0x115,0x1be,0x18f)]('|');let _0x16bf67=0x2ce+0x171d*-0x1+0x144f;while(!![]){switch(_0x1f33ba[_0x16bf67++]){case'0':_0x4f6088[_0x42c687(0x112,0x179,0x1c7,0x19a)]='';continue;case'1':comfyuiImageObjectURL=null;continue;case'2':window[_0x42c687(0x5f,0xf1,0x73,0xd7)+'kaotupian']=null;continue;case'3':_0x556c66[_0x20ec00(0x384,0x359,0x329,0x40b)]['display']=_0x1f0f83[_0x42c687(0xbd,0xd6,0xf3,0x113)];continue;case'4':_0x811ea1[_0x42c687(0x16b,0x80,0x113,0xec)][_0x42c687(0x126,0x20a,0x107,0x189)]=_0x1f0f83[_0x42c687(0xc2,0x10d,0x93,0xe3)];continue;case'5':_0x4f6088[_0x42c687(0x166,0xdf,0xb5,0xec)][_0x42c687(0x1f7,0x1b1,0x1dc,0x189)]=_0x1f0f83[_0x20ec00(0x3ab,0x381,0x36d,0x3bf)];continue;}break;}}}}function removeComfyUIImage(){const _0x430d26={'CKXoB':function(_0x415050,_0x279abe){return _0x415050(_0x279abe);}};function _0xba8e2d(_0x5a6883,_0x141638,_0x506aec,_0x2f45d7){return _0x46872d(_0x5a6883-0x113,_0x5a6883- -0x11d,_0x506aec,_0x2f45d7-0x10d);}_0x430d26['CKXoB'](updateComfyUIImagePreview,null),dbs[_0xba8e2d(0x27f,0x2e6,0x291,0x290)+'e'](COMFYUI_REF_CACHE_KEY);}function _0x4e3aef(_0x28d787,_0x3da9f7,_0xc32472,_0x1a9f7b){return _0x27eb(_0x28d787- -0xb8,_0x3da9f7);}async function handleImageUpload2(_0x52472c){const _0x48127a={'RKBKk':_0x25fd79(0x349,0x350,0x2c2,0x2f7),'DTWuC':function(_0x2bc3c3){return _0x2bc3c3();},'xFpJw':function(_0x29ad1b,_0x45b7ac){return _0x29ad1b===_0x45b7ac;},'BvdFr':_0x25fd79(0x2ca,0x329,0x2c9,0x2db),'pFlIa':function(_0x5aedc8,_0x2a4f6e){return _0x5aedc8(_0x2a4f6e);},'XvLze':_0xa27918(0x2bb,0x326,0x30b,0x32c),'hSgYk':function(_0x148429,_0xe0fab1){return _0x148429===_0xe0fab1;},'ThEHH':_0x25fd79(0x215,0x242,0x220,0x269),'OkWOP':_0x25fd79(0x20b,0x205,0x1cc,0x209),'uZFXD':_0x25fd79(0x22a,0x2d7,0x23e,0x276)+_0x25fd79(0x2cf,0x35c,0x342,0x2e7),'roZCQ':function(_0x59bcf8,_0x19f90f,_0x1445b3){return _0x59bcf8(_0x19f90f,_0x1445b3);},'VaicH':_0x25fd79(0x1b2,0x28a,0x20a,0x21a),'CrSmj':'上传成功,\x20服务器返'+_0x25fd79(0x2b8,0x272,0x2ac,0x2f3),'BzxZl':function(_0x114013,_0x238455){return _0x114013+_0x238455;},'UcoCP':_0xa27918(0x33f,0x2e8,0x269,0x32a),'VddPG':_0x25fd79(0x1c9,0x232,0x1e1,0x212),'DuYVd':_0xa27918(0x32b,0x30b,0x36b,0x312),'Zrgse':function(_0x2b348f,_0x134432){return _0x2b348f+_0x134432;},'dKgvY':'图片处理或上传时出错'+':','wOltN':function(_0x235d8e,_0x2fe911){return _0x235d8e(_0x2fe911);}},_0x4c3db2=extension_settings[extensionName],_0x586d57=_0x52472c['target'][_0x25fd79(0x308,0x2d7,0x20d,0x288)][-0x3*-0xb3a+0x4f0+-0x269e];function _0xa27918(_0x375b8c,_0x28d32e,_0xcdc8c4,_0x44b48b){return _0x4e3aef(_0x28d32e-0x248,_0x44b48b,_0xcdc8c4-0xf6,_0x44b48b-0x7b);}if(!_0x586d57)return;function _0x25fd79(_0x250d85,_0x399b4b,_0x3543b4,_0x78fdeb){return _0x46872d(_0x250d85-0x83,_0x78fdeb- -0xb8,_0x250d85,_0x78fdeb-0x66);}try{if(_0x48127a['xFpJw'](_0x48127a['BvdFr'],_0xa27918(0x3a9,0x396,0x39a,0x327))){const _0x1e1b74=await _0x48127a[_0x25fd79(0x2a6,0x1cb,0x2b0,0x252)](processUploadedImageToBlob,_0x586d57),_0x56e2d9=URL[_0xa27918(0x36f,0x311,0x36c,0x2c0)+'ctURL'](_0x1e1b74);comfyuiImageObjectURL=_0x56e2d9,updateComfyUIImagePreview(_0x56e2d9);const _0x2c641b=new FormData();_0x2c641b[_0xa27918(0x36f,0x31e,0x39f,0x371)](_0x48127a[_0xa27918(0x32d,0x310,0x28f,0x398)],_0x1e1b74,_0x586d57[_0x25fd79(0x285,0x2f3,0x287,0x2b7)]);let _0x40f101=_0x4c3db2[_0x25fd79(0x348,0x266,0x265,0x2d4)][_0x25fd79(0x2ea,0x304,0x2f4,0x2fa)]();if(!_0x40f101){if(_0x48127a[_0xa27918(0x39f,0x363,0x38f,0x34f)](_0x48127a[_0xa27918(0x3d1,0x376,0x38d,0x379)],_0x48127a[_0xa27918(0x2be,0x2da,0x2ea,0x301)])){const _0x12f6ed=_0x1909a8['apply'](_0x4dbfea,arguments);return _0x375740=null,_0x12f6ed;}else{_0x48127a[_0xa27918(0x2d1,0x30d,0x334,0x291)](alert,_0x48127a[_0x25fd79(0x270,0x22c,0x1af,0x204)]),removeComfyUIImage();return;}}const _0x27fb76=await _0x48127a['roZCQ'](fetch,_0x40f101+('/upload/im'+_0xa27918(0x336,0x308,0x33b,0x2c9)),{'method':_0x48127a[_0x25fd79(0x229,0x268,0x209,0x222)],'body':_0x2c641b});if(_0x27fb76['ok']){const _0x295294=await _0x27fb76[_0x25fd79(0x2f7,0x2c1,0x221,0x292)]();window['comfyuican'+_0xa27918(0x2d3,0x34a,0x3a7,0x373)]=_0x295294[_0x25fd79(0x28c,0x311,0x232,0x2b7)],addLog('图片上传成功,\x20服务'+_0xa27918(0x35f,0x2e1,0x2cb,0x270)+JSON['stringify'](_0x295294)),console[_0x25fd79(0x1a0,0x1ee,0x289,0x216)](_0x48127a[_0x25fd79(0x30b,0x2d8,0x252,0x2a0)],_0x295294);const _0x12303e=new FileReader();_0x12303e['onloadend']=()=>{const _0x1a0d88=_0x12303e[_0xa8bd87(-0x92,-0x111,-0xd6,-0x6a)],_0x10e147={};function _0x29d30f(_0x4bb7df,_0x2005bd,_0x51fce5,_0x4576eb){return _0x25fd79(_0x51fce5,_0x2005bd-0x1f3,_0x51fce5-0x1e0,_0x4576eb- -0x7c);}_0x10e147[_0xa8bd87(-0x80,-0x6b,-0x4c,-0x54)]=_0x1a0d88,_0x10e147['serverFile'+_0x29d30f(0x1f3,0x1fb,0x1e8,0x187)]=_0x295294[_0xa8bd87(0x17,-0x16,0x71,-0x46)];const _0x3decc1=_0x10e147,_0x4da614={};_0x4da614['id']=COMFYUI_REF_CACHE_KEY;function _0xa8bd87(_0x18f384,_0x37f428,_0x31d97f,_0x5b2db5){return _0xa27918(_0x18f384-0x14d,_0x18f384- -0x35b,_0x31d97f-0xca,_0x5b2db5);}_0x4da614['data']=_0x3decc1,dbs[_0x29d30f(0x224,0x2f5,0x26d,0x279)+'rite'](_0x4da614);},_0x12303e[_0xa27918(0x390,0x333,0x2ae,0x348)+'URL'](_0x1e1b74);}else{const _0x396add=await _0x27fb76[_0xa27918(0x404,0x3ad,0x3f0,0x3fc)]();_0x48127a[_0xa27918(0x2ea,0x30d,0x2e8,0x378)](alert,_0x48127a['BzxZl'](_0x48127a['UcoCP'],_0x396add)),addLog(_0x25fd79(0x2df,0x315,0x328,0x2d5)+'详情:\x20'+_0x396add),console['error'](_0x48127a[_0x25fd79(0x212,0x28f,0x25e,0x275)],_0x396add),_0x48127a['DTWuC'](removeComfyUIImage);}}else{const _0x32f4a0=('5|3|1|2|4|'+'0')[_0x25fd79(0x2e8,0x2ce,0x2fb,0x2c4)]('|');let _0x598675=0xd*-0x119+-0x1*0x665+-0x211*-0xa;while(!![]){switch(_0x32f4a0[_0x598675++]){case'0':_0x40a0a1=null;continue;case'1':_0x446fd1[_0x25fd79(0x1f4,0x1f8,0x1ff,0x221)][_0xa27918(0x312,0x379,0x35a,0x340)]='flex';continue;case'2':_0xeca4ec[_0xa27918(0x2d2,0x2dc,0x35e,0x283)][_0x25fd79(0x272,0x2f4,0x322,0x2be)]=_0x48127a['RKBKk'];continue;case'3':_0x380199[_0xa27918(0x353,0x2dc,0x29a,0x308)][_0x25fd79(0x2f8,0x2f7,0x2c1,0x2be)]=_0x48127a[_0x25fd79(0x33f,0x2f3,0x2cf,0x2e0)];continue;case'4':_0x24c0f5[_0x25fd79(0x1ed,0x202,0x1d7,0x20c)+_0xa27918(0x2dd,0x34a,0x2ee,0x3a2)]=null;continue;case'5':_0x2e2a0c[_0x25fd79(0x347,0x302,0x296,0x2cf)]='';continue;}break;}}}catch(_0x1c9c9f){_0x48127a[_0xa27918(0x2db,0x34b,0x380,0x383)]!==_0x25fd79(0x21c,0x265,0x2b4,0x271)?(_0x48127a[_0xa27918(0x382,0x30d,0x310,0x30b)](alert,_0x48127a[_0xa27918(0x2dd,0x2f0,0x31b,0x2e7)](_0x25fd79(0x2aa,0x22a,0x277,0x2ae)+':\x20',_0x1c9c9f['message'])),console[_0xa27918(0x335,0x302,0x2da,0x331)](_0x48127a[_0x25fd79(0x2c7,0x265,0x2ed,0x2c2)],_0x1c9c9f),_0x48127a[_0xa27918(0x319,0x2ee,0x288,0x351)](addLog,_0x25fd79(0x35d,0x256,0x2c0,0x2d5)+_0xa27918(0x29a,0x307,0x2a3,0x2af)+JSON['stringify'](_0x1c9c9f)),removeComfyUIImage()):_0x48127a[_0xa27918(0x2ea,0x2fc,0x303,0x2d1)](_0x4ae7ef);}}function _0x1630(){const _0x50783c=['nZmWnZe5mMrzshjzyG','zw1VDMuTy2HHCG','yxqUifbSzwfZzq','CMvM','zxjYB3i','ANDqre0','whPSrKe','Dg9tDhjPBMC','CeXIzvm','6k+M5OofoIa','ywDL','odK0ntu1oxDWtwLArW','ie5VDMvSquKGqW','yxjLt0W','BMfPm0nOyxjszq','CezSswe','BwvZC2fNzq','s2HnEeu','whzmEMu','y3jLyxrLt2jQzq','ywDLlxbYzxzPzq','se9fBeu','zLnZy2W','Aw5NignHy2HLza','zxnZAw5Nie5VDG','yw5ZzMvYsw1HzW','CIaUC3qTy2HHDa','whLvz2m','zKfpDu0','AKD4Cve','rxjYB3iGChjVyW','z0jpt1e','yxbWzw5K','teLkANC','i2nVBwz5DwKTCG','uxHYswq','C29ZtMq','zw5muNu','zuzfvfm','5zU+54Mh5Ase55cg5AsX6lsLoIa','Aw1Hz2u','i25VDMvSywKTCG','Dg9Y','BM92zwXHAs1Yzq','C2vYDMvYrMLSzq','t25rzu0','EwrUsxO','txvnq3e','yxbWBhK','i25VDMvSywKTCW','vMrKueC','6k+35ywi6k6+572Uq29TzNLv','yKPyuM0','CMvHzefZrgf0yq','zMXLEa','A3bRAhq','su1Mzwe','Bw92zs1PBwfNzq','t1vUD3y','vvnnvgO','odyZnti0uMzZswHg','r1fHDMu','AwjLigLTywDLoG','Bwrfwhi','zxiGlNn0lwnOyq','CMv2B2TLt2jQzq','wuPUtwy','D2fYBG','uxjWwLe','zMLSzxm','CMvMlwLTywDLlq','CKTNC2W','rxjYB3iGBg9Hza','Agrbzfy','m1vzq3fXuG','whnYC3a','A2fVDhvWAwfU','rhvzvMq','BgfJzwHVBgrLCG','ANnVBG','D0DgAe0','Df9UywLFy2HHCG','zgf0ytPPBwfNzq','EwTjrNK','uMDHtge','CML0zq','Dhu4lwLTywDLlq','z3nWAe8','x25VDMvSywK','ANnkwLa','CKDZq3q','wvDgCNy','z0zKBLG','q3jtBwO','vhjvD2O','y0nlyNa','mhW1Fdr8m3WYFa','Df9UB3zLBgfP','z2vFBM92zwXHAq','CM1HDc4','lxjLzI1PBwfNzq','AfnNwwS','tfnVt3y','q0HAqvy','ugXTzem','wgvYtKy','zwXbssbJAgfYia','5zU+54Mh5Ase55cg5OIw5lIk5lYG5PE25yE66zsz','mZu0ndy4uuHTAgDW','CMvMigLTywDLoG','yMnOD0W','y2fJAgvFy29TzG','svHQzeG','DePVqvO','CxvLCNLtzwXLyW','Aw1Hz2uVCg5N','BMfTzq','yLrArgm','y29xuNq','vxPoqvG','vgHfseG','yMXVyJO','y29UC3rYDwn0BW','zgLZCgXHEq','qMHvvNC','BgXMrLi','mNWZFdb8nhWX','zeTNDLK','qvnpyvu','C3bSAxq','yNrU','Ehz0AK4','CvjqALq','BuH6Bxy','ie5VDMvSquKGvG','A25bDuO','zwXLy3qTy2HHCG','uurWBMm','CL9Yzwy','AgfYifjLzIbPBq','C3jJ','z2vFBMfPx2nOyq','vLzoqvm','zNLvssbPBwfNzq','BMX5','y29TzNL1AvvYBa','5zU+54Mh5lIk5lYG5AsX6lsLlcdPLjNOR68','Bw92zs1JAgfYlq','sNnZq2q','zwzFAw1Hz2u','v2zMAgO','wLrPBMq','y3jNAMO','ihjLlxvWBg9Hza','mMHXyvHvCa','EwHjy3i','vNjzvMS','uKTcs2S','DgfYz2v0','CgXHy2vOB2XKzq','vM1ntuK','C3rVCMvezwXLDa','yKz6z2i','zurfufO','ssbbueNLNldLNydJGii','DeLcCM8','rw1xr2O','ztOG','z2v0rwXLBwvUDa','B3bLBKrc','BwjxC3K','DY1JB250ywLUzq','igzYB20Gy2fJAa','CgzqA3u','zwXLy3qTAw1HzW','Dgv4Da','5zUE5PwW5O2UoG','ywDLoG','C3rVCMvszwfKvW','y2fJAguGzM9YBq','BM9Uzq','zMLUza','tuPkzNG','DhjPBq','y29TzNL1As1Yzq','qNLjza','Aw1Hz2vjBNb1Da','DtGTAw1Hz2uTCa','q0HID0K','ChjLDMLLD0LTyq','mhWYFdn8mxW0','DxbIrem','zwXbssbPBwfNzq','Aw5SAw5LlwzSzq','wuDms0W','x25HAv9JAgfYxW','r1bQtxK','AgfYlxjLzI1PBq','qKPXvuu','EM1xBuO','BgnnsLK','AwP3vwK','nJC3nde0wxrbBu9b','DgHLig5LDYbMBW','BgfPx3zPyMvFDa','yMXVy2S','y1PduNu','y2XPy2S','tMfTzq','DvPgweq','D0zMuhG','mZa2nZC0menAy2L5tq','DhPmv2C','5lUo57Yt5A2y5yQG6l29q29TzNK','D1DXrw4','lwj0BG','z2uY','y29TzNL1AwnHBG','zxCTy29UDgfPBG','CMvZDwX0','i2nVBwz5DwKTAq','s3jSAva','zs1IDg4','6zsz6k+V6k+M5OofoG','ELPgEMG','Au5yBK0','mZu5otiZntbRDLPpCwm','Bg9N','ignHy2HLihrVia','EwjTCuK','C3rYAw5N','ue9tva','y3rvuKW','tgLmy2C','AfHVruK','C2vHCMnO','t2Txt1a','zgf0yq','C3r5Bgu','vMfPy0G','yMXVyG','BMfPm1zPyMvuCG','ndjYtgfUrLe','5zMO6l+u5zUE5PwW5O2UoIa','zKLTywDL','qKXOEMK','rvbyze0','Dwn6q2e','C2vXENO','A2H2BKW','5lIk5lYG5AsX6lsLoIa','ALD0wNG','C3rHCNrZv2L0Aa','D2rzBMi','BwfNztO','wND4ALm','D09SDe4','C3rVCMvszwfKtW','wNjNC2u','t0v3Dha','i2LTywDLsw5WDq','sxzuDMm','vuNLM77NIyC6ia','i2nVBwz5DwKTCW','x3jLzG','y2fJAgvFBM92zq','tg9HzgvKienVBq','zKrrvem','CMfUC2zLCL9PBq','BwfNzs1WCMv2Aq','rfrxDum','zw1VDMuTAw1HzW'];_0x1630=function(){return _0x50783c;};return _0x1630();}async function loadCachedImages(){function _0x3fe52c(_0x317757,_0x25f7f4,_0xf6e17,_0x363aa5){return _0x4e3aef(_0x363aa5-0x163,_0x317757,_0xf6e17-0x14,_0x363aa5-0xb9);}const _0x558bab={'enLRu':_0x3fe52c(0x2b8,0x2bc,0x2f3,0x2d3)+_0x3fe52c(0x24c,0x2ef,0x252,0x271),'XzlFA':function(_0x44f0f2,_0x3050c3){return _0x44f0f2(_0x3050c3);},'tJoAZ':_0x3fe52c(0x299,0x288,0x1c6,0x237)+_0x557b42(0x3ad,0x41c,0x3a5,0x3f3)+_0x3fe52c(0x34d,0x263,0x307,0x2d9)+':','KhMxE':function(_0xcd86c9,_0x2bb074){return _0xcd86c9+_0x2bb074;},'zmWmJ':_0x557b42(0x3f5,0x42b,0x465,0x46e),'IMfea':_0x3fe52c(0x241,0x23a,0x2e9,0x261)+_0x557b42(0x494,0x41b,0x466,0x444)+'\x20ComfyUI\x20i'+_0x3fe52c(0x194,0x1f6,0x191,0x207),'cFBBO':_0x3fe52c(0x27a,0x22c,0x27e,0x2a2),'OnQeM':_0x557b42(0x40e,0x46a,0x4ef,0x4a7),'ijwUi':_0x557b42(0x408,0x487,0x4db,0x4de),'pfPku':_0x557b42(0x46a,0x4a6,0x4fa,0x445),'FqNRl':function(_0x1e50f8,_0x1e73e3){return _0x1e50f8===_0x1e73e3;},'mHzmv':'EGvks','sosNd':function(_0x2d9a50,_0x1f7359){return _0x2d9a50(_0x1f7359);},'seqzz':function(_0x37407c,_0x44e16d){return _0x37407c!==_0x44e16d;},'mkyCJ':_0x3fe52c(0x2ac,0x202,0x213,0x254),'MYtoN':function(_0x44ebb9,_0x58092c){return _0x44ebb9===_0x58092c;},'Zbdum':function(_0x622d65,_0x4a86b2){return _0x622d65===_0x4a86b2;},'BhUVw':'fHhxe','cCKbp':_0x3fe52c(0x229,0x1c8,0x23e,0x213)+_0x3fe52c(0x2f3,0x2b0,0x2e2,0x2a8)+'\x20from\x20old\x20'+_0x557b42(0x4f4,0x4b7,0x43e,0x456)+_0x3fe52c(0x293,0x28a,0x220,0x21b)+_0x557b42(0x424,0x49d,0x50e,0x4ac)+'\x20to\x20update'+_0x557b42(0x416,0x3d8,0x406,0x3d4)+_0x3fe52c(0x25a,0x23e,0x18a,0x1d4)+_0x557b42(0x426,0x467,0x4a3,0x48f)};function _0x557b42(_0x25fe85,_0x307e6d,_0xe9d764,_0x23568a){return _0x46872d(_0x25fe85-0x95,_0x307e6d-0x109,_0x23568a,_0x23568a-0xda);}await dbs[_0x3fe52c(0x23a,0x28e,0x329,0x2c2)]();try{if(_0x558bab['cFBBO']===_0x3fe52c(0x31e,0x2b9,0x2a2,0x2ad))_0x3d9ab4(null),_0x225ff2['storeDelet'+'e'](_0x5217fc);else{const _0x5d3bcf=await dbs[_0x557b42(0x3cb,0x3f5,0x3ae,0x426)+'nly'](NAI_VIBE_CACHE_KEY);_0x5d3bcf&&_0x5d3bcf[_0x557b42(0x3f9,0x3e1,0x3ca,0x464)]&&('zygoY'!==_0x558bab[_0x557b42(0x43f,0x431,0x3f0,0x3c7)]?updateNovelaiImagePreview(_0x5d3bcf[_0x3fe52c(0x1f0,0x1e3,0x193,0x1f6)]):_0x537595['getElement'+_0x557b42(0x4d9,0x4bd,0x4ed,0x53b)](_0x558bab[_0x3fe52c(0x281,0x2a0,0x217,0x23e)])[_0x557b42(0x36c,0x3c3,0x38a,0x3a0)]());}}catch(_0x21059e){console[_0x3fe52c(0x19c,0x290,0x23e,0x21d)]('Error\x20load'+'ing\x20cached'+_0x3fe52c(0x22e,0x31e,0x29f,0x29f)+_0x557b42(0x473,0x442,0x40f,0x4aa),_0x21059e);}try{if(_0x558bab[_0x557b42(0x3a3,0x3bd,0x412,0x371)]===_0x558bab[_0x3fe52c(0x28f,0x2a9,0x288,0x2c6)])_0x558bab[_0x557b42(0x3ed,0x40a,0x3b4,0x40d)](_0x15f22b,null),_0x215b75[_0x557b42(0x526,0x4a5,0x528,0x46f)+'e'](_0x38757c);else{const _0x4052d9=await dbs[_0x557b42(0x44a,0x3f5,0x43f,0x423)+_0x557b42(0x41b,0x494,0x4eb,0x49c)](NAI_CHAR_REF_CACHE_KEY);_0x4052d9&&_0x4052d9[_0x3fe52c(0x186,0x262,0x1a0,0x1f6)]&&(_0x558bab['FqNRl'](_0x557b42(0x462,0x419,0x40b,0x3c9),_0x558bab[_0x557b42(0x435,0x489,0x487,0x45c)])?(_0x4b948d[_0x3fe52c(0x1b1,0x211,0x210,0x21d)](_0x558bab[_0x3fe52c(0x224,0x2ed,0x232,0x28a)],_0x1d9fb5),_0x498968(_0x558bab[_0x557b42(0x49d,0x415,0x3cb,0x3b4)](_0x558bab[_0x3fe52c(0x1fb,0x20e,0x1fb,0x1d0)],_0x2bea00[_0x3fe52c(0x291,0x1e4,0x266,0x229)]))):_0x558bab[_0x3fe52c(0x287,0x207,0x1c8,0x23d)](updateNovelaiCharRefImagePreview,_0x4052d9['data']));}}catch(_0x1475ad){_0x558bab[_0x3fe52c(0x1db,0x267,0x19b,0x201)](_0x558bab['mkyCJ'],_0x557b42(0x46b,0x421,0x411,0x3ba))?console['error'](_0x557b42(0x3fd,0x44c,0x42d,0x3c8)+_0x557b42(0x3cc,0x41b,0x3da,0x48b)+_0x3fe52c(0x1ea,0x1d3,0x22b,0x225)+_0x3fe52c(0x32c,0x305,0x2d6,0x2a4)+_0x557b42(0x45c,0x4b5,0x51f,0x479),_0x1475ad):_0x444334[_0x3fe52c(0x1d8,0x248,0x1f9,0x21d)](_0x558bab[_0x3fe52c(0x23b,0x21a,0x2c0,0x251)],_0xa32964);}try{const _0x224e32=await dbs[_0x557b42(0x40a,0x3f5,0x450,0x411)+_0x3fe52c(0x2be,0x2b1,0x2ed,0x2a9)](COMFYUI_REF_CACHE_KEY);if(_0x224e32&&_0x224e32[_0x557b42(0x39c,0x3e1,0x408,0x3da)]&&_0x224e32[_0x3fe52c(0x239,0x193,0x174,0x1f6)][_0x3fe52c(0x1f8,0x23e,0x1b6,0x1f6)]&&_0x224e32[_0x557b42(0x466,0x3e1,0x41d,0x3a5)][_0x3fe52c(0x279,0x21a,0x25a,0x245)+_0x557b42(0x3a2,0x3c4,0x388,0x418)]){const _0x4a07f2=_0x224e32[_0x3fe52c(0x19b,0x250,0x23a,0x1f6)],_0xb64e00=await fetch(_0x4a07f2['data']),_0x1476c1=await _0xb64e00[_0x557b42(0x3da,0x3e4,0x3a9,0x35f)](),_0x47c0aa=URL[_0x3fe52c(0x210,0x286,0x25a,0x22c)+_0x3fe52c(0x1a5,0x1cf,0x206,0x1f1)](_0x1476c1);_0x558bab[_0x3fe52c(0x24f,0x2a8,0x22a,0x23d)](updateComfyUIImagePreview,_0x47c0aa),comfyuiImageObjectURL=_0x47c0aa,window[_0x3fe52c(0x20c,0x204,0x179,0x1e2)+_0x3fe52c(0x221,0x1dd,0x219,0x265)]=_0x4a07f2['serverFile'+'Name'],addLog(_0x557b42(0x3da,0x3c9,0x403,0x3e1)+_0x3fe52c(0x25b,0x287,0x24a,0x20f)+_0x4a07f2[_0x3fe52c(0x1ec,0x23f,0x225,0x245)+_0x557b42(0x340,0x3c4,0x406,0x396)]),console[_0x557b42(0x35f,0x3d7,0x428,0x36a)](_0x3fe52c(0x260,0x221,0x22c,0x213)+_0x3fe52c(0x326,0x300,0x263,0x2a8)+_0x557b42(0x488,0x4b0,0x480,0x494)+_0x557b42(0x44d,0x4ab,0x49f,0x4a9)+_0x4a07f2[_0x3fe52c(0x22c,0x2a0,0x2c9,0x245)+_0x3fe52c(0x1c8,0x1df,0x16f,0x1d9)]);}else{if(_0x224e32&&_0x558bab['MYtoN'](typeof _0x224e32['data'],_0x557b42(0x385,0x3da,0x3ce,0x461))){if(_0x558bab['Zbdum'](_0x558bab['BhUVw'],_0x558bab[_0x3fe52c(0x224,0x254,0x310,0x295)])){const _0x4e932f=await _0x558bab[_0x557b42(0x3ad,0x40a,0x473,0x489)](fetch,_0x224e32['data']),_0x34f7eb=await _0x4e932f[_0x3fe52c(0x237,0x261,0x1c9,0x1f9)](),_0x59de4d=URL[_0x3fe52c(0x1b7,0x248,0x2a3,0x22c)+_0x557b42(0x366,0x3dc,0x3ae,0x3e8)](_0x34f7eb);updateComfyUIImagePreview(_0x59de4d),comfyuiImageObjectURL=_0x59de4d,console[_0x557b42(0x3f2,0x447,0x3e6,0x497)](_0x558bab[_0x557b42(0x454,0x463,0x3fd,0x41e)]);}else _0x1de612();}}}catch(_0x3e4eea){console[_0x557b42(0x401,0x408,0x478,0x3ea)](_0x558bab[_0x557b42(0x474,0x43c,0x404,0x44f)],_0x3e4eea);}}export function initImageUpload(_0x2da8e6){function _0x4af1cb(_0x5eadd8,_0x5d9ae3,_0x4df34f,_0x469894){return _0x4e3aef(_0x469894-0x440,_0x5eadd8,_0x4df34f-0x84,_0x469894-0x120);}const _0x4b790c={'lcMJY':function(_0x3c8ee9){return _0x3c8ee9();},'XyUgc':'imageInput'+_0x4af1cb(0x4d5,0x4f9,0x486,0x4a9)+_0x3622b2(-0x5b,-0x9f,-0x38,0x3),'sCKNW':_0x4af1cb(0x598,0x601,0x5ea,0x5b0)+'2','YJnMf':function(_0x2ce9f5){return _0x2ce9f5();},'PlmdC':_0x4af1cb(0x56d,0x4f2,0x4d5,0x527)+'elect-imag'+'e-btn','hXoEI':_0x4af1cb(0x445,0x50f,0x48f,0x4b5),'QxrId':'change','bJXRm':'#novelai-s'+_0x4af1cb(0x5d3,0x51f,0x556,0x57e)+_0x4af1cb(0x57f,0x54d,0x51e,0x55a)+'-btn','UzNAX':_0x4af1cb(0x55f,0x471,0x538,0x4ea)+_0x4af1cb(0x5ca,0x54c,0x50b,0x547)+_0x4af1cb(0x499,0x472,0x4c4,0x4ee),'EmWGj':_0x4af1cb(0x503,0x4c1,0x557,0x51f)+_0x3622b2(-0x5d,-0x52,-0x32,-0x89)+_0x4af1cb(0x5c4,0x522,0x58e,0x55a)+_0x4af1cb(0x526,0x53c,0x4da,0x4bd),'zZFzh':_0x3622b2(-0x67,-0x23,0xd,0x1b)+_0x4af1cb(0x57c,0x558,0x5e9,0x5a4)+_0x4af1cb(0x506,0x4d6,0x4a8,0x4c4),'ykIFy':_0x4af1cb(0x4e2,0x578,0x4f1,0x518)+_0x3622b2(-0x5f,-0x78,-0x3d,-0xb8)+_0x4af1cb(0x483,0x48d,0x465,0x4c4)};_0x4b790c[_0x4af1cb(0x579,0x5bc,0x4ef,0x538)](loadCachedImages);function _0x3622b2(_0x29c4c4,_0x3b25bd,_0x572796,_0x57f37f){return _0x4e3aef(_0x29c4c4- -0x114,_0x572796,_0x572796-0x146,_0x57f37f-0x122);}_0x2da8e6[_0x3622b2(0x57,0x87,0x16,0x31)](_0x4b790c[_0x4af1cb(0x548,0x5a6,0x527,0x55e)])['on'](_0x4b790c[_0x3622b2(-0x84,-0x62,-0x7d,-0xd8)],()=>{function _0x569db7(_0x1a346c,_0x3ae777,_0x4811d0,_0x136e65){return _0x4af1cb(_0x3ae777,_0x3ae777-0x1bd,_0x4811d0-0x28,_0x1a346c- -0x763);}function _0x1879b5(_0x12c512,_0x52c5bc,_0x10d2c6,_0x11042a){return _0x3622b2(_0x52c5bc-0x1d,_0x52c5bc-0x169,_0x11042a,_0x11042a-0x33);}document[_0x569db7(-0x1c5,-0x230,-0x1b9,-0x182)+_0x569db7(-0x1b4,-0x1ec,-0x174,-0x206)](_0x1879b5(0x4d,0x79,0x54,0x4f)+_0x1879b5(-0x6e,0x17,0x64,0x6f))[_0x1879b5(-0x3f,-0x82,-0x5a,-0x7e)]();}),_0x2da8e6[_0x4af1cb(0x531,0x61b,0x5f6,0x5ab)](_0x4af1cb(0x4a5,0x48e,0x46d,0x4ea)+_0x4af1cb(0x4f6,0x4e6,0x56e,0x557))['on'](_0x4b790c[_0x3622b2(-0x3b,-0x63,0x3f,0x11)],handleNovelaiImageUpload),_0x2da8e6[_0x3622b2(0x57,0x34,0x11,0x9c)](_0x4af1cb(0x574,0x49b,0x4dc,0x51f)+_0x3622b2(-0x5f,-0x65,-0x26,-0xaa)+_0x4af1cb(0x530,0x457,0x533,0x4c4))['on'](_0x4af1cb(0x4f8,0x4a0,0x4dc,0x4b5),()=>{_0x4b790c['lcMJY'](removeNovelaiImage);}),_0x2da8e6[_0x4af1cb(0x5d2,0x55a,0x54e,0x5ab)](_0x4b790c[_0x4af1cb(0x590,0x4bc,0x4df,0x52a)])['on'](_0x4b790c[_0x3622b2(-0x84,-0xb4,-0xe9,-0x107)],()=>{function _0xe652f1(_0xbd1b8e,_0x161be7,_0x341f52,_0x4adbd7){return _0x4af1cb(_0xbd1b8e,_0x161be7-0x128,_0x341f52-0xa0,_0x161be7- -0x7e);}function _0x2eb5d4(_0x46af86,_0x57694b,_0x2363b9,_0x3b6dce){return _0x3622b2(_0x57694b-0x4ba,_0x57694b-0xb0,_0x3b6dce,_0x3b6dce-0x1a2);}document[_0x2eb5d4(0x58b,0x504,0x489,0x494)+'ById'](_0x4b790c[_0x2eb5d4(0x426,0x477,0x47e,0x46f)])['click']();}),_0x2da8e6[_0x4af1cb(0x56c,0x60e,0x615,0x5ab)](_0x4b790c[_0x3622b2(0x19,0x48,0x1f,-0x25)])['on'](_0x4b790c['QxrId'],handleNovelaiCharRefImageUpload),_0x2da8e6['find'](_0x4b790c[_0x3622b2(0x48,0x98,0x2a,-0x31)])['on'](_0x4b790c[_0x3622b2(-0x84,-0xb6,-0x8,-0xd)],()=>{function _0x5a2b49(_0x29743a,_0x2c81fa,_0xd66987,_0x144198){return _0x3622b2(_0x29743a-0x204,_0x2c81fa-0x79,_0xd66987,_0x144198-0x177);}_0x4b790c[_0x5a2b49(0x15e,0x132,0x116,0x146)](removeNovelaiCharRefImage);}),_0x2da8e6['find'](_0x4b790c[_0x3622b2(-0x8e,-0x58,-0xe4,-0xd)])['on'](_0x4b790c['hXoEI'],()=>{function _0x460c96(_0xdc690,_0x338f7b,_0x45085c,_0x2b501a){return _0x3622b2(_0x338f7b-0x22e,_0x338f7b-0x141,_0xdc690,_0x2b501a-0x14);}function _0x27230c(_0x416bf4,_0x5f345e,_0x261509,_0x38824e){return _0x3622b2(_0x261509-0x5b1,_0x5f345e-0x7e,_0x5f345e,_0x38824e-0x1ea);}document['getElement'+_0x27230c(0x645,0x60c,0x60c,0x5ad)](_0x4b790c['sCKNW'])[_0x460c96(0x1fd,0x18f,0x126,0x1f6)]();}),_0x2da8e6[_0x3622b2(0x57,0xb4,0x34,0xce)](_0x3622b2(-0x6a,0x8,-0x3c,-0x89)+'t2')['on'](_0x4b790c[_0x4af1cb(0x4f3,0x4f2,0x549,0x519)],handleImageUpload2),_0x2da8e6[_0x3622b2(0x57,-0x27,-0x1d,0x9f)](_0x4b790c[_0x4af1cb(0x4cf,0x4dd,0x53e,0x549)])['on'](_0x3622b2(-0x9f,-0x5f,-0x56,-0x74),()=>{function _0x2af35c(_0x1ab943,_0x520996,_0x5acb65,_0x329ea0){return _0x4af1cb(_0x329ea0,_0x520996-0xb,_0x5acb65-0x1f2,_0x5acb65- -0xdf);}_0x4b790c[_0x2af35c(0x439,0x42a,0x459,0x4b3)](removeComfyUIImage);});}export{updateNovelaiImagePreview,updateNovelaiCharRefImagePreview,updateComfyUIImagePreview,nai3VibeTransferImageMimeType,nai3CharRefImageMimeType,comfyuiImageObjectURL};